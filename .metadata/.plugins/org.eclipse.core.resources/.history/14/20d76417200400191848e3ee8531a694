/**
 * @NApiVersion 2.x
 * @NScriptType suitelet
 * @NAmdConfig ./configuration.json
 */
define(
		[ 'N/https', 'oauth', 'cryptojs' ],
		function(https, oauth, cryptojs) {
			function testRequest(context) {
				if (context.request.method == 'GET') {
					var requestUrl = 'https://rest.netsuite.com/app/site/hosting/restlet.nl?script=24&deploy=1'; // REST
					// Endpoint
					// URL
					var consumerKey = '9e72438e65e08749ff4711b37780fdb67cdb63de3ea27df543780cc3d84c42b4'; // CONSUMER
					// KEY
					var consumerSecret = '0807af6184874e0702885afd449e881b9753cd417948df0c5ad71f02661a53b9'; // CONSUMER
					// SECRET
					var tokenId = '08cdd11671776d125eb59bbbda01ad6831295bf0649b18639b1ee031b08cf4cb'; // TOKEN
					// ID
					var tokenSecret = '461b4dc85f5f1c30ba47bd5a707da945ed13edbab92670cbec6f50135ec8c17d'; // TOKEN
					// SECRET
					var realm = '5144758_SB1'; // REALM

					var baseString = 'jfdkfdklfjkl';

					var reqBody = {
						"a_parameter" : 'abc123',
					};

					// Build Token-Based Authorization

					function hashfunctionsha1(base_string, key) {
						return CryptoJS.HmacSHA256(base_string, key).toString(
								CryptoJS.enc.Base64);
					}

					var auth = OAuth({
						consumer : {
							public : consumerKey,
							secret : consumerSecret
						},
						signature_method : 'HMAC-SHA256',
						hash_function : hashfunctionsha1(baseString,
								consumerKey)

					});

					var token = {
						public : tokenId,
						secret : tokenSecret
					};

					var request_data = {
						url : requestUrl,
						method : 'POST',
						data : {}
					};

					var authHead = auth.toHeader(auth.authorize(request_data,
							token));
					var reqHeaders = {
						'Content-Type' : 'application/json',
						'Authorization' : authHead.Authorization + ', realm="'
								+ realm + '"'
					};

					var req = https.post({
						url : requestUrl,
						body : JSON.stringify(reqBody),
						headers : reqHeaders
					});

					log.debug({
						title : 'Resp',
						details : req.body
					});

					var html = '<html><body>' + 'Calling: ' + requestUrl
							+ '<br><br>' + 'Generated OAuth header:<br>'
							+ authHead.Authorization + ', realm="' + realm
							+ '"' + '<br><br>' + 'Full header stack:<br>'
							+ JSON.stringify(reqHeaders) + '<br><br>'
							+ 'Payload:<br>' + JSON.stringify(reqBody)
							+ '<br><br>' + 'Response:<br>' + req.body
							+ '</body></html>';

					context.response.write(html);
				}
			}

			return {
				onRequest : testRequest
			};
		});