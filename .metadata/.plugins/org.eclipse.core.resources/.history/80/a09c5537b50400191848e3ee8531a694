/**
 * @NApiVersion 2.x
 * @NScriptType UserEventScript
 * @NModuleScope SameAccount
 * @author YQ12681
 */

define([], function() {
	function beforeLoad(context) {
		// context. newRecord,type,form,request

		//getText不能用于beforeLoad?
		/*var er = {
			"type" : "error.SuiteScriptError",
			"name" : "SSS_INVALID_API_USAGE",
			"message" : "Invalid API usage. You must use getValue to return the value set with setValue. ",
			"stack" : [ "anonymous(N/serverRecordService)",
					"beforeLoad(/SuiteScripts/Bansi_Scripts/WorkOrderToMaterialApplyBs.js:13)" ],
			"cause" : {
				"type" : "internal error",
				"code" : "SSS_INVALID_API_USAGE",
				"details" : "Invalid API usage. You must use getValue to return the value set with setValue. ",
				"userEvent" : "beforeload",
				"stackTrace" : [ "anonymous(N/serverRecordService)",
						"beforeLoad(/SuiteScripts/Bansi_Scripts/WorkOrderToMaterialApplyBs.js:13)" ],
				"notifyOff" : false
			},
			"id" : "",
			"notifyOff" : false,
			"userFacing" : false
		};
		 */
		var status = context.newRecord.getText({
			fieldId : 'custrecord_yq_workorder_status_bs'
		});

		// 如果工单状态已审批加载<生成领料单>按钮		
		try {
			if (status === 'APPROVED'
					& context.type == context.UserEventType.VIEW) {

				context.form.clientScriptModulePath = './CreateMAOBs.js';
				context.form.addButton({
					id : 'custpage_generate_mao',
					label : '生成领料单',
					functionName : 'create_mao_url'
				});
			}
			log.debug({
				title : 'Success',
				details : '添加-生成领料单-按钮成功！ status = ' + status
			});
		} catch (ex) {
			log.debug({
				title : ex.name,
				details : ex.message
			});
		}
	}

	return {
		beforeLoad : beforeLoad
	};
});