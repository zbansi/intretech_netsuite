/**
 * @NApiVersion 2.x
 * @NScriptType ScheduledScript
 */
define(
		[ 'N/search', 'N/runtime', 'N/record', 'N/email' ],
		function(search, runtime, record, email) {
			function execute(context) {
				//if (context.type != context.InvocationType.ON_DEMAND)
				//return;
				var searchId = runtime.getCurrentScript().getParameter(
						"custscriptcustomsearch_bansi_mtl_search");
				try {
					search
							.load({
								id : searchId
							})
							.run()
							.each(
									function(result) {
										try {
											var maoRecord = record
													.load({
														type : 'customrecord_yq_material_apply_bansi',
														id : result.id
													});
										} catch (error) {
											if (error.code == 'RCRD_LOCKED_BY_WF') // Check what kind of error is thrown, in this case its locked record by a workflow
											{
												continue; // If true, then skipped this record and continue on the next record
											}
										}
										
										if (maoRecord)
											var count = maoRecord
													.getLineCount('recmachcustrecord_yq_material_apply_detail_h_bs');
										for (var i; i < count; i++) {
											maoRecord
													.setSublistValue(
															'recmachcustrecord_yq_material_apply_detail_h_bs',
															'custrecord_yq_material_apply_line_use_bs',
															i, 'init领料');

										}
										maoRecord.save;
										log.debug({
											details : 'MAO编号：' + maoRecord.id
													+ ' count = ' + count
										});
										return true;

									});
				} catch (e) {
					var subject = '更新领料申请单行用途字段失败！';
					var authorId = 5;
					var recipientEmail = 'xmzyl@intretech.com';
					email.send({
						author : authorId,
						recipients : recipientEmail,
						subject : subject,
						body : '脚本中出现错误：' + runtime.getCurrentScript().id
								+ JSON.stringify(e)

					});

					log.debug({
						title : e.name,
						details : e.message
					});
				}
			}
			return {
				execute : execute
			}
		});