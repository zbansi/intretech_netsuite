/**
 * @NApiVersion 2.x
 * @NScriptType Restlet
 * @NModuleScope SameAccount
 * @author Zhu Yanlong
 */
/////////////////////////BOMュ////////////////////////////
//	POST
// 	GET
//	DELETE
//	PUT
//////////////////////////////////////////////////////////
define([ 'N/record', 'N/search', 'N/runtime', '../dao/dao' ], function(record, search,
		runtime, dao) {

	function doGet(requestParams) {
		//				var recordType = 'bom';
		//				var filterList = [ [ 'name', 'is', 'EAI.TEST.190422A01-cBOM' ] ];
		//				var columnList = [ 'name', 'memo', ];
		log.debug({
			title : 'requestParams',
			details : requestParams
		});
		var filterList = [];
		var columnList = [];
		var columnRegExp = /.+/;
		var filterRegExp = /.+/;
		var fenceRegExp1 = /(\],)+|(,\[)+/;
		var fenceRegExp2 = /,/;
		try {
			var recordType = requestParams.recordType;
			//婚ょ┖
			var filterListStr = requestParams.filterList.replace(/[""''\s]/g,
					'');
			//婚ら灏炬规17					
			filterListStr = filterListStr.replace(/\[{2,10}/g, '');
			filterListStr = filterListStr.replace(/\]{2,10}/g, '');
			log.debug({
				title : 'filterList replace',
				details : filterListStr
			});
			//灏瀛绗涓茶浆㈡涓绱扮17
			filterList = filterRegExp.exec(filterListStr);//杩扮
			log.debug({
				title : 'filterRegExp.exec',
				details : filterList
			});

			//浠ュ虫规烽17|峰乏规蜂负绗锛灏扮绱灏杞㈡澶涓绱涓17缁存扮17
			filterList = filterList.map(function(f) {//f瀛绗涓
				return f.split(fenceRegExp1);
			});
			log.debug({
				title : 'filterList.map1',
				details : filterList
			});
			//杩婊ゆ扮涓17"","],",",[",","
			filterList = filterList[0].filter(function(e) {
				if (e != "" && e != "]," && e != ",[" && e != ",")
					return e;
			});
			log.debug({
				title : 'filterList filter',
				details : filterList
			});
			//灏涓缁存扮涓舵扮储寮绱17峰灏杞㈡扮17
			filterList = filterList.map(function(f) {//f扮17
				if (filterList.indexOf(f) % 2)
					return f;
				else
					return f.split(fenceRegExp2);
			});
			log.debug({
				title : 'filterList.map2',
				details : filterList
			});

			var columnListStr = requestParams.columnList.replace(/[""''\s]/g,
					'');

			columnListStr = columnListStr.replace(/\[+/g, '');
			columnListStr = columnListStr.replace(/\]+/g, '');

			log.debug({
				title : 'columnList replace 1',
				details : columnListStr
			});
			columnList = columnRegExp.exec(columnListStr);//杩扮
			log.debug({
				title : 'columnList regexp',
				details : columnList
			});
			columnList = columnList.map(function(f) {//f扮17
				return f.split(",");
			})[0];

			log.debug({
				title : 'columnList map',
				details : columnList
			});

			return {
				"resultSet" : dao.getSearchResultSet(recordType, filterList,
						columnList)
			};
		} catch (e) {
			log.debug({
				title : 'doGet Error :' + e.name,
				details : e.message
			});
		}
	}

	return {
		'get' : doGet
	};
});