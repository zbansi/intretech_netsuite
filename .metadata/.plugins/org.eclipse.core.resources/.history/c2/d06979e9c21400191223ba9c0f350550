/**
 * @NApiVersion 2.x
 * @NScriptType Suitelet
 * @NAmdConfig ./configuration.json
 * 
 * Sample 2.0 Suitelet to invoke restlet using Token-based Authentication
 */
define(
		[ 'N/https', '/SuiteScripts/util/oauth', '/SuiteScripts/util/secret' ],

		function(https, oauth, secret) {
			function onRequest(context) {
				if (context.request.method == 'GET') {

					var url = 'https://5144758-sb1.restlets.api.netsuite.com/app/site/hosting/restlet.nl?script=24&deploy=1';
					var method = 'PUT';
					var headers = oauth.getHeaders({
						url : url,
						method : method,
						tokenKey : secret.token.public,
						tokenSecret : secret.token.secret
					});

					var body = {
						datum1 : 'datum1',
						datum2 : 'foobar'
					}

					headers['Content-Type'] = 'application/json';

					var restResponse = https.put({
						url : url,
						headers : headers,
						body : JSON.stringify(body)
					});
					log.debug('response', JSON.stringify(restResponse));
					log.debug('headers', headers);

					var html = '<html><body>' + 'Calling: ' + requestUrl
							+ '<br><br>' + ', realm="' + realm + '"'
							+ '<br><br>' + 'Full header stack:<br>'
							+ JSON.stringify(reqHeaders) + '<br><br>'
							+ 'Payload:<br>' + JSON.stringify(reqBody)
							+ '<br><br>' + 'Response0:<br>' + req.body
							+ '<br><br>' + 'Response1:<br>' + rep1.body
							+ '<br><br>' + 'Response2:<br>' + rep2.body
							+ '</body></html>';

					context.response.write(html);
				}
				return {
					onRequest : onRequest
				};
			}
		});