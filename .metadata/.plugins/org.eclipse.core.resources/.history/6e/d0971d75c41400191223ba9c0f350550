/**
 * @NApiVersion 2.x
 * @NScriptType Suitelet
 * 
 * Sample 2.0 Suitelet to invoke restlet using Token-based Authentication
 */
define(
		[ 'N/https', '/SuiteScripts/util/oauth', '/SuiteScripts/util/secret' ],

		function(https, oauth, secret) {
			function onRequest(context) {
				if (context.request.method == 'GET') {

					var url = 'https://5144758-sb1.restlets.api.netsuite.com/app/site/hosting/restlet.nl?script=24&deploy=1';
					var method = 'PUT';
					var headers = oauth.getHeaders({
						url : url,
						method : method,
						tokenKey : secret.token.public,
						tokenSecret : secret.token.secret
					});

					var body = {
						datum1 : 'datum1',
						datum2 : 'foobar'
					}

					headers['Content-Type'] = 'application/json';

					var restResponse = https.put({
						url : url,
						headers : headers,
						body : JSON.stringify(body)
					});
					log.debug('response', JSON.stringify(restResponse));
					log.debug('headers', headers);
					

					var restResponse2 = https.get({
						url : url,
						headers : headers
					});
					log.debug('response', JSON.stringify(restResponse2));
					log.debug('headers', headers);

					var html = '<html><body>' + 'Calling: ' + url + '<br><br>'
							+ 'Full header stack:<br>'
							+ JSON.stringify(headers) + '<br><br>'
							+ 'Payload:<br>' + JSON.stringify(body)
							+ '<br><br>' + 'Response:<br>' + restResponse.body
							+ '<br><br>' + JSON.stringify(headers)
							+ '<br><br>' + '<br><br>' + 'Response:<br>'
							+ restResponse2.body

							+ '</body></html>';

					context.response.write(html);
				}

			}
			return {
				onRequest : onRequest
			};
		});