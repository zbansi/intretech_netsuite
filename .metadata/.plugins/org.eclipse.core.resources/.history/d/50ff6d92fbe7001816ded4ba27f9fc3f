/**
 * @NApiVersion 2.x
 * @NScriptType Suitelet
 * @NModuleScope SameAccount
 */
define([ 'N/ui/serverWidget' ],

function(ui) {

	/**
	 * Definition of the Suitelet script trigger point.
	 * 
	 * @param {Object}
	 *            context
	 * @param {ServerRequest}
	 *            context.request - Encapsulation of the incoming request
	 * @param {ServerResponse}
	 *            context.response - Encapsulation of the Suitelet response
	 * @Since 2015.2
	 */
	function onRequest(context) {
		if (context.request.method === 'GET') {
			var form = ui.createForm({
				title : 'A bansi Suitelet Form'
			});
			var abansiTextField = form.addField({
				id : 'abansi',
				label : 'abansi Text Field',
				type : ui.FieldType.TEXT,
				source : '',
				container : ''
			});
			form.addSubmitButton({
				label : 'Click me!'
			});
			context.response.writePage(form);
		} else {
			var request = context.request;
			switch (request.parameters.abansiTextField) {
			case 'file':
				require([ 'N/file' ], function(file) {
					function createAndSaveFile() {
						var fileObj = file.create({
							name : 'bansi_test.txt',
							fileType : file.Type.PLAINTEXT,
							contents : 'Hello World\nHello World'
						});
						fileObj.folder = -15;
						var id = fileObj.save();
						fileObj = file.load({
							id : id
						});
					}
					createAndSaveFile();
					context.response.write('You have created a file:'+ fileOjb.name);
				});

			case 'email':
				require([ 'N/email', 'N/runtime' ], function(email, runtime) {
					function sendEmail() {

						var request = context.request;
						email.send({
							author : runtime.getCurrentUser().id,
							recipients : '377132229@qq.com',
							subject : request.parameters.abansi,
							body : 'a bansi suitelet form test'

						});
					}
					sendEmail();
					context.response.write('You have sent a email!');
				});

			case 'dialog':
				require([ 'N/dialog' ], function(dialog) {
					function dialogAlert() {
						var options = {
							title : 'Hello!',
							message : 'Hello, World! '
						};
						try {
							dialog.alert(options);
							log.debug({
								title : 'Success',
								details : 'Require invoke successfully'
							});
						} catch (e) {
							log.error({
								title : e.name,
								details : e.message
							});
						}
					}
					dialogAlert();
					context.response.write('You have invoke requie function successfully!');
				});
				default :return null;
			}
		}
	}

	return {
		onRequest : onRequest
	};
});
