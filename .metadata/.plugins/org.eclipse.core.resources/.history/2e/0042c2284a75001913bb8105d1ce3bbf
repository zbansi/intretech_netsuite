/*
 * "The item fulfillment record is partially scriptable â€” it can be updated, deleted, and searched using
SuiteScript. It cannot be created or copied."
 */

require([ 'N/record' ], function(record) {
	/**
	 * context.transactionData
	 */
	function createAndSaveInventoryTransfer(context) {
		var transactionResult = [];
		var rec = record.create({
			type : record.Type.INVENTORY_TRANSFER
		});
		var transactionData = context.transactionData;

		transactionData.forEach(function(transaction) {
			for ( var key in transaction) {
				if (transaction.hasOwnProperty(key) && key != 'item') {
					rec.setValue({
						fieldId : key,
						value : transaction[key]
					});
				} else if (transaction.hasOwnProperty(key) && key == 'item') {
					var j = 0;
					transaction.item.forEach(function(line) {
						rec.setSublistValue({
							sublistId : 'item',
							fieldId : 'location',
							value : line.location,
							line : j
						});
						rec.setSublistValue({
							sublistId : 'item',
							fieldId : 'quantity',
							value : line.quantity,
							line : j
						});
						rec.setSublistValue({
							sublistId : 'item',
							fieldId : 'item',
							value : line.item,
							line : j
						});

						log.debug({
							title : 'rec',
							details : rec
						});
						j++;

						var subrec = rec.getSublistSubrecord({
							sublistId : 'item',
							line : line.line,
							fieldId : 'inventorydetail'
						});

						log.debug({
							title : 'subrec ',
							details : subrec
						});
						var i = 0;
						line.details.forEach(function(detail) {
							subrec.setSublistValue({
								sublistId : 'inventoryassignment',
								fieldId : 'issueinventorynumber',
								value : detail.lotnumber,
								line : i
							});
						});
					});
				}

			}
		});

		return {
			"isSuccess" : true,
			"transactionResult" : transactionResult
		}
		log.debug({
			title : 'transactionResult ',
			details : transactionResult
		});
	}

	var transactionData = {
		"transactionData" : [ {
			"subsidiary" : "11335",
			"location" : "",
			"transferlocation" : "",
			"postingperiod" : "",
			"memo" : "",
			"item" : [ {
				"line" : 0,
				"item" : "10",
				"quantity" : 3,
				"location" : "1",
				"details" : [ {
					"binnumber" : "1",
					"lotnumber" : "141",
					"status" : "1",
					"quantity" : 1
				}, {
					"binnumber" : "1",
					"lotnumber" : "38",
					"status" : "1",
					"quantity" : 1
				}, {
					"binnumber" : "1",
					"lotnumber" : "50",
					"status" : "1",
					"quantity" : 1
				} ]
			} ]
		}, {
			"subsidiary" : "11335",
			"location" : "",
			"transferlocation" : "",
			"postingperiod" : "",
			"memo" : "",
			"item" : [ {
				"line" : 0,
				"item" : "10",
				"quantity" : 2,
				"location" : "1",
				"details" : [ {
					"binnumber" : "1",
					"lotnumber" : "38",
					"status" : "1",
					"quantity" : 2
				} ]
			}, {
				"line" : 1,
				"item" : "10",
				"quantity" : 3,
				"location" : "1",
				"details" : [ {
					"binnumber" : "1",
					"lotnumber" : "38",
					"status" : "1",
					"quantity" : 3
				} ]
			} ]
		} ]
	};

	var itemFulfillment = createAndSaveInventoryTransfer(transactionData);
});
