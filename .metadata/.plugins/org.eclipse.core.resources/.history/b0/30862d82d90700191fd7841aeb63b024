/**
 * @NApiVersion 2.x
 * @NScriptType Suitelet
 * @author YQ12681
 */
////////////////////Description////////////////////
//
//此Suitelet接收请求参数领料单Id(maoId)
//并输出PDF预览响应
//
//////////////////////////////////////////////////
define(
		[ 'N/record', 'N/render' ],
		function(record, render) {
			function onRequest(params) {
				//解析url参数 maoid
				try {
					var maoIdArray = params.request.parameters.maoid.split('_');
					log.debug({
						title : 'Success',
						details : 'maoId参数获取成功 maoIdArray: ' + maoIdArray
					});

				} catch (e) {
					log.debug({
						title : e.name,
						details : e.message
					});

				}
				var xmlStr = '';
				xmlStr += '<?xml version="1.0"?><!DOCTYPE pdf PUBLIC "-//big.faceless.org//report" "report-1.1.dtd">';
				xmlStr += '<pdf>';

				//加载领料申请记录
				for (var i = 0; i < maoIdArray.length; i++) {
					var rec = record.load({
						type : 'customrecord_yq_material_apply_bansi',
						id : maoIdArray[i]
					});
					var maoNumber = rec.getText('name');

					//xml定义打印模板

					xmlStr += '<head>';
					xmlStr += '</head>';
					xmlStr += '<body padding="0.5in 0.5in 0.5in 0.5in" size="Letter">';
					xmlStr += '<table style="width: 100%; font-size: 10pt;">';
					xmlStr += '<tr><td>' + maoNumber + '</td></tr>';
					xmlStr += '</table></body>';

				}
				xmlStr += '</pdf>'
				//xml转成pdf文件
				var pdfFile = render.xmlToPdf({
					xmlString : xmlStr
				});

				//输出文件
				params.response.writeFile({
					file : pdfFile,
					isInline : true
				});

			}

			return {
				onRequest : onRequest
			};
		});