/**
 * @NApiVersion 2.x
 * @NScriptType ScheduledScript
 */
define(
		[ 'N/search', 'N/runtime', 'N/record', 'N/email' ],
		function(search, runtime, record, email) {
			function execute(context) {
				//if (context.type != context.InvocationType.ON_DEMAND)
				//return;
				var searchId = runtime.getCurrentScript().getParameter(
						"custscriptcustomsearch_bansi_mtl_search");
				try {
					search
							.load({
								id : searchId
							})
							.run()
							.each(
									function(result) {

										//custrecord_yq_material_apply_line_use_bs
										var count = result
												.getLineCount('recmachcustrecord_yq_material_apply_detail_h_bs');
										for (var i; i < count; i++) {
											result
													.setSublistValue(
															'recmachcustrecord_yq_material_apply_detail_h_bs',
															'custrecord_yq_material_apply_line_use_bs',
															i, 'init领料');

										}
										result.save;
										log.debug({
											details : 'MAO编号：' + result.id
													+ ' count = ' + count
										});
										return true;

									});
				} catch (e) {
					var subject = '更新领料申请单行用途字段失败！';
					var authorId = 5;
					var recipientEmail = 'xmzyl@intretech.com';
					email.send({
						author : authorId,
						recipients : recipientEmail,
						subject : subject,
						body : '脚本中出现错误：' + runtime.getCurrentScript().id
								+ JSON.stringify(e)

					});
				}
			}
			return {
				execute : execute
			}
		});